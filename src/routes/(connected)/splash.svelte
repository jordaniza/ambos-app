<script lang="ts">
	import { fade } from 'svelte/transition';
	import { onDestroy, onMount } from 'svelte';
	import { page } from '$app/stores';
	import { EXCLUDED_SPLASH_ROUTES } from '$lib/constants';
	import LoadingSpinner from '$lib/components/ui/loadingSpinner/loading-spinner.svelte';

	export let isLoading = true;
	let showLoading = false;

	function preventScroll(_: HTMLElement) {
		document.body.classList.add('overflow-hidden');

		onDestroy(() => {
			document.body.classList.remove('overflow-hidden');
		});

		return {};
	}

	setTimeout(() => {
		showLoading = true;
	}, 1500);

	$: currentPage = $page.url.pathname;
	$: excludedRoute = EXCLUDED_SPLASH_ROUTES.includes(
		currentPage as (typeof EXCLUDED_SPLASH_ROUTES)[number]
	);
	$: {
		if (!isLoading) document.body.classList.remove('overflow-hidden');
	}
</script>

{#if !excludedRoute && isLoading}
	<div
		class="fixed inset-0 flex flex-col items-center justify-center bg-background z-50"
		transition:fade
		use:preventScroll
	>
		<div class="flex flex-col items-center transform -translate-y-24 gap-5">
			<svg
				xmlns="http://www.w3.org/2000/svg"
				width="135"
				height="36"
				viewBox="0 0 135 36"
				fill="none"
			>
				<path
					d="M0.934505 25.8817C0.934505 23.9088 2.12926 22.8747 4.22008 22.6317L16.3218 20.9065C16.3218 14.2538 15.8738 12.4811 9.89516 12.4811C7.55383 12.4811 4.4176 12.9719 2.02809 13.5628L1.62823 11.2468C4.22008 10.5558 7.50565 10.0649 10.295 10.0649C18.5138 10.0649 19.1593 13.072 19.1593 22.5268V35.1888H16.5675V30.9523C15.4739 34.4025 13.2289 35.632 9.24479 35.632C3.11686 35.632 0.929688 32.9729 0.929688 25.877L0.934505 25.8817ZM5.01979 24.7475C4.2249 24.8953 3.77686 25.3861 3.77686 26.1248C3.77686 31.5432 5.22213 33.316 9.65428 33.316C14.785 33.316 16.3796 30.5567 16.3796 23.4609V23.0653L5.02461 24.738L5.01979 24.7475Z"
					fill="#48B25C"
				/>
				<path
					d="M29.5219 35.1888H26.7325V10.408H29.3244L29.4255 12.5764C31.5163 11.099 34.1564 9.96484 36.647 9.96484C39.6339 9.96484 42.0283 10.5081 43.6181 12.8242C45.5114 11.4946 49.1968 9.96484 51.6875 9.96484C57.9117 9.96484 60.0026 12.8718 60.0026 19.3768V35.1888H57.2132V19.6198C57.2132 14.3491 55.7679 12.4763 50.8877 12.4763C49.2931 12.4763 45.9064 13.7582 44.3118 14.9877C44.6105 15.5786 44.7598 17.4038 44.7598 19.6675V35.184H41.9704V19.615C41.9704 13.8011 41.0262 12.4715 35.6932 12.4715C34.1516 12.4715 31.5115 13.4056 29.5171 14.9829V35.184L29.5219 35.1888Z"
					fill="#48B25C"
				/>
				<path
					d="M70.3555 11.9855C71.8008 11.2469 74.9852 10.065 76.6328 10.065C83.6568 10.065 86.5425 13.1197 86.5425 22.8224C86.5425 31.1954 83.8543 35.5844 75.3851 35.5844C72.8944 35.5844 70.3074 35.3366 67.5662 34.9935V0.753177L70.3555 0.505371V11.9855ZM70.3555 14.4017V32.7299C71.4491 32.8776 74.2385 33.1254 75.3369 33.1254C80.5158 33.1254 83.6038 31.2049 83.6038 22.8271C83.6038 14.4493 81.5612 12.5812 76.0836 12.5812C74.489 12.5812 71.5503 13.7154 70.3555 14.4064V14.4017Z"
					fill="#48B25C"
				/>
				<path
					d="M112.191 22.7746C112.191 31.6909 109.652 35.632 102.228 35.632C94.8046 35.632 92.2176 31.6909 92.2176 22.7746C92.2176 13.8583 94.8576 9.96484 102.228 9.96484C109.599 9.96484 112.191 13.9059 112.191 22.7746ZM102.228 33.1682C107.706 33.1682 109.252 29.9658 109.252 22.7746C109.252 15.5834 107.711 12.4763 102.228 12.4763C96.7461 12.4763 95.1563 15.5786 95.1563 22.7746C95.1563 29.9706 96.7027 33.1682 102.228 33.1682Z"
					fill="#48B25C"
				/>
				<path
					d="M118.069 31.8911C120.309 32.5297 123.599 33.173 125.887 33.173C130.122 33.173 131.765 32.1389 131.765 28.3932C131.765 25.3861 130.768 24.7475 126.037 23.8612C119.711 22.6793 117.871 21.445 117.871 17.0607C117.871 11.7901 120.911 10.0649 126.437 10.0649C128.778 10.0649 131.962 10.5081 134.207 10.999L133.861 13.4151C131.669 12.8718 128.73 12.4286 126.639 12.4286C122.703 12.4286 120.762 13.315 120.762 16.913C120.762 19.7723 121.908 20.3108 127.338 21.3974C133.215 22.5316 134.66 23.7134 134.66 28.2931C134.66 33.6639 132.218 35.5844 126.095 35.5844C123.305 35.5844 120.318 34.9934 117.577 34.3549L118.073 31.8911H118.069Z"
					fill="#48B25C"
				/>
			</svg>
			<div class="text-center tracking-widest flex flex-col items-center justify-center">
				<p class="font-thin text-muted-foreground">Invest For Tomorrow</p>
				<p class="font-semibold">Live For Today</p>
				<LoadingSpinner
					class={'text-primary animate-spin mt-2 transition-opacity duration-1000 ' +
						(showLoading ? ' opacity-100' : ' opacity-0')}
				/>
			</div>
		</div>

		<svg
			width="557"
			height="431"
			viewBox="0 0 557 431"
			class="absolute -bottom-16"
			fill="none"
			xmlns="http://www.w3.org/2000/svg"
		>
			<path
				d="M492.686 198.54L314.873 173.201C314.707 163.638 314.377 154.565 313.964 146.146C315.204 116.884 318.427 98.0846 326.363 86.3144C336.614 71.1113 357.611 65.2262 401.176 65.2262C433.663 65.2262 481.113 71.7652 522.281 81.9824C523.355 82.2276 524.512 82.391 525.587 82.391C528.232 82.391 530.795 81.6554 533.11 80.1841C536.334 78.1407 538.483 74.8712 539.144 71.1113L545.427 34.4931C546.584 27.6272 542.285 21.0064 535.507 19.1265C490.454 7.11113 437.879 0 394.976 0C336.944 0 301.068 9.39977 278.252 31.6323C255.436 9.39977 219.56 0 161.528 0C118.542 0 66.0497 7.19287 20.997 19.1265C14.2185 20.9247 9.83722 27.5454 11.0772 34.4931L17.3598 71.1113C18.0211 74.7895 20.1704 78.1407 23.3943 80.1841C25.6263 81.6554 28.2716 82.391 30.9169 82.391C31.9916 82.391 33.1489 82.2276 34.2236 81.9824C75.3083 71.8469 122.841 65.2262 155.328 65.2262C198.893 65.2262 219.89 71.1113 230.141 86.3144C238.077 98.1663 241.383 116.884 242.54 146.146C242.127 154.647 241.797 163.638 241.631 173.201L63.8178 198.54C22.6503 203.444 0 226.412 0 263.357C0 324.251 10.3332 364.875 32.6529 391.112C55.7166 418.331 91.4281 431 145.161 431C180.707 431 206.829 425.115 227.413 412.364C232.373 409.258 237.085 405.743 241.383 401.82V410.402C241.383 417.84 247.5 423.971 255.106 423.971H301.894C309.417 423.971 315.617 417.922 315.617 410.402V401.82C319.915 405.743 324.545 409.258 329.587 412.364C350.088 425.033 376.211 431 411.839 431C465.572 431 501.366 418.331 524.347 391.112C546.584 364.875 557 324.251 557 263.357C557 226.494 534.35 203.444 493.182 198.54H492.686ZM223.197 337.656C209.64 358.172 187.403 367.327 151.113 367.327C110.358 367.327 96.5533 356.783 89.0307 347.628C77.3749 333.324 71.919 307.74 71.919 267.199C71.919 263.766 72.5803 260.251 80.1855 258.78L241.053 235.076V278.642C237.911 305.043 232.125 324.333 223.197 337.738V337.656ZM467.143 347.628C459.62 356.783 445.815 367.327 405.061 367.327C368.771 367.327 346.534 358.172 332.977 337.656C324.131 324.251 318.262 304.961 315.121 278.56V234.994L475.988 258.698C483.676 260.169 484.254 263.684 484.254 267.117C484.254 307.659 478.798 333.242 467.143 347.546V347.628Z"
				fill="#48B25C"
				fill-opacity="0.33"
			/>
		</svg>
	</div>
{/if}
